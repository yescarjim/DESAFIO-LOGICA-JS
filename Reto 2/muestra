/**
 * ğŸ§ CAJERO AUTOMÃTICO
 * Simulador completo de cajero automÃ¡tico con JavaScript
 */

// ===== CONFIGURACIÃ“N INICIAL =====
const PIN_CORRECTO = "1234";
const SALDO_INICIAL = 100000;
const INTENTOS_MAXIMOS = 3;

// ===== VARIABLES GLOBALES =====
let saldoActual = SALDO_INICIAL;
let intentosFallidos = 0;
let sistemaActivo = true;

// ===== FUNCIÃ“N PRINCIPAL =====
function iniciarCajero() {
    console.log("ğŸ§ ===== BIENVENIDO AL CAJERO AUTOMÃTICO =====");
    console.log("ğŸ’³ Inserte su tarjeta para comenzar...");
    console.log("");
    
    // Reiniciar variables por si es un nuevo inicio
    saldoActual = SALDO_INICIAL;
    intentosFallidos = 0;
    sistemaActivo = true;
    
    // Iniciar proceso de autenticaciÃ³n
    autenticarUsuario();
}

// ===== MÃ“DULO 1: AUTENTICACIÃ“N =====
function autenticarUsuario() {
    console.log("ğŸ” AUTENTICACIÃ“N REQUERIDA");
    console.log(`â„¹ï¸  Para esta simulaciÃ³n, el PIN correcto es: ${PIN_CORRECTO}`);
    console.log("");
    
    while (sistemaActivo && intentosFallidos < INTENTOS_MAXIMOS) {
        // Solicitar PIN al usuario
        let pinIngresado = prompt("ğŸ”‘ Ingrese su PIN de 4 dÃ­gitos:\n\nğŸ’¡ PIN de prueba: 1234");
        
        // Verificar si el usuario cancelÃ³
        if (pinIngresado === null) {
            console.log("âŒ OperaciÃ³n cancelada por el usuario");
            cerrarSistema();
            return;
        }
        
        // Validar PIN
        if (pinIngresado === PIN_CORRECTO) {
            console.log("âœ… PIN CORRECTO - Acceso autorizado");
            console.log("ğŸ‰ Â¡Bienvenido al sistema!");
            console.log("");
            
            // Ir al menÃº principal
            mostrarMenuPrincipal();
            return;
        } else {
            intentosFallidos++;
            let intentosRestantes = INTENTOS_MAXIMOS - intentosFallidos;
            
            console.log(`âŒ PIN INCORRECTO`);
            console.log(`âš ï¸  Intentos restantes: ${intentosRestantes}`);
            
            if (intentosRestantes > 0) {
                alert(`âŒ PIN INCORRECTO\n\nTe quedan ${intentosRestantes} intentos.`);
            }
        }
    }
    
    // Si llegamos aquÃ­, se agotaron los intentos
    if (intentosFallidos >= INTENTOS_MAXIMOS) {
        console.log("ğŸš« TARJETA BLOQUEADA");
        console.log("âŒ Demasiados intentos fallidos");
        console.log("ğŸ“ Contacte a su banco para desbloquear su tarjeta");
        alert("ğŸš« TARJETA BLOQUEADA\n\nâŒ Demasiados intentos fallidos\nğŸ“ Contacte a su banco para desbloquear");
        cerrarSistema();
    }
}

// ===== MÃ“DULO 2: MENÃš PRINCIPAL =====
function mostrarMenuPrincipal() {
    let continuar = true;
    
    while (continuar && sistemaActivo) {
        console.log("ğŸ“‹ ===== MENÃš PRINCIPAL =====");
        console.log("1ï¸âƒ£  Ver saldo actual");
        console.log("2ï¸âƒ£  Retirar dinero");
        console.log("3ï¸âƒ£  Salir del sistema");
        console.log("============================");
        
        let opcion = prompt(`ğŸ“‹ MENÃš PRINCIPAL

1ï¸âƒ£ Ver saldo actual
2ï¸âƒ£ Retirar dinero  
3ï¸âƒ£ Salir del sistema

Seleccione una opciÃ³n (1-3):`);
        
        // Verificar si el usuario cancelÃ³
        if (opcion === null) {
            console.log("âŒ OperaciÃ³n cancelada");
            cerrarSistema();
            return;
        }
        
        // Procesar opciÃ³n seleccionada
        switch (opcion) {
            case "1":
                verSaldo();
                break;
            case "2":
                retirarDinero();
                break;
            case "3":
                cerrarSistema();
                continuar = false;
                break;
            default:
                console.log("âŒ OpciÃ³n invÃ¡lida. Por favor seleccione 1, 2 o 3");
                alert("âŒ OpciÃ³n invÃ¡lida\n\nPor favor seleccione nÃºmeros del 1 al 3");
        }
    }
}

// ===== MÃ“DULO 3: VER SALDO =====
function verSaldo() {
    console.log("ğŸ’° ===== CONSULTA DE SALDO =====");
    console.log(`ğŸ’µ Su saldo actual es: $${saldoActual.toLocaleString()}`);
    console.log("================================");
    
    // Mostrar tambiÃ©n en alert para mejor visualizaciÃ³n
    alert(`ğŸ’° CONSULTA DE SALDO

ğŸ’µ Su saldo actual es:
$${saldoActual.toLocaleString()}`);
    
    // Preguntar si desea continuar
    let continuar = confirm("Â¿Desea realizar otra operaciÃ³n?");
    if (!continuar) {
        cerrarSistema();
    }
}

// ===== MÃ“DULO 4: RETIRAR DINERO =====
function retirarDinero() {
    console.log("ğŸ’¸ ===== RETIRO DE DINERO =====");
    console.log(`ğŸ’° Saldo disponible: $${saldoActual.toLocaleString()}`);
    
    let monto = prompt(`ğŸ’¸ RETIRO DE DINERO

ğŸ’° Saldo disponible: $${saldoActual.toLocaleString()}

ğŸ’µ Ingrese el monto a retirar:`);
    
    // Verificar si el usuario cancelÃ³
    if (monto === null) {
        console.log("âŒ Retiro cancelado");
        return;
    }
    
    // Convertir a nÃºmero y validar
    monto = parseFloat(monto);
    
    // ValidaciÃ³n 1: Verificar que sea un nÃºmero vÃ¡lido
    if (isNaN(monto)) {
        console.log("âŒ ERROR: Debe ingresar un nÃºmero vÃ¡lido");
        alert("âŒ ERROR\n\nDebe ingresar un monto numÃ©rico vÃ¡lido");
        return;
    }
    
    // ValidaciÃ³n 2: Verificar que sea mayor a 0
    if (monto <= 0) {
        console.log("âŒ ERROR: El monto debe ser mayor a $0");
        alert("âŒ ERROR\n\nEl monto debe ser mayor a $0");
        return;
    }
    
    // ValidaciÃ³n 3: Verificar fondos suficientes
    if (monto > saldoActual) {
        console.log("âŒ FONDOS INSUFICIENTES");
        console.log(`ğŸ’° Su saldo actual: $${saldoActual.toLocaleString()}`);
        console.log(`ğŸ’¸ Monto solicitado: $${monto.toLocaleString()}`);
        console.log(`âŒ Faltante: $${(monto - saldoActual).toLocaleString()}`);
        
        alert(`âŒ FONDOS INSUFICIENTES

ğŸ’° Su saldo: $${saldoActual.toLocaleString()}
ğŸ’¸ Monto solicitado: $${monto.toLocaleString()}
âŒ Faltante: $${(monto - saldoActual).toLocaleString()}`);
        
        // Preguntar si quiere intentar con otro monto
        let intentarOtroMonto = confirm("Â¿Desea intentar con otro monto?");
        if (intentarOtroMonto) {
            retirarDinero(); // Llamada recursiva
        }
        return;
    }
    
    // Si llegamos aquÃ­, el retiro es vÃ¡lido
    procesarRetiro(monto);
}

// ===== FUNCIÃ“N AUXILIAR: PROCESAR RETIRO =====
function procesarRetiro(monto) {
    let saldoAnterior = saldoActual;
    
    console.log("â³ Procesando retiro...");
    
    // Actualizar saldo inmediatamente
    saldoActual = saldoActual - monto;
    
    // Generar comprobante
    generarComprobante(monto, saldoAnterior, saldoActual);
    
    // Preguntar si desea continuar
    let continuar = confirm("Â¿Desea realizar otra operaciÃ³n?");
    if (!continuar) {
        cerrarSistema();
    }
}

// ===== FUNCIÃ“N AUXILIAR: GENERAR COMPROBANTE =====
function generarComprobante(montoRetirado, saldoAnterior, nuevoSaldo) {
    let fecha = new Date();
    let fechaFormateada = fecha.toLocaleDateString('es-ES');
    let horaFormateada = fecha.toLocaleTimeString('es-ES');
    
    console.log("âœ… ===== TRANSACCIÃ“N EXITOSA =====");
    console.log("ğŸ« ===== COMPROBANTE DE RETIRO =====");
    console.log(`ğŸ“… Fecha: ${fechaFormateada}`);
    console.log(`ğŸ• Hora: ${horaFormateada}`);
    console.log(`ğŸ’¸ Monto retirado: $${montoRetirado.toLocaleString()}`);
    console.log(`ğŸ’° Saldo anterior: $${saldoAnterior.toLocaleString()}`);
    console.log(`ğŸ’µ Nuevo saldo: $${nuevoSaldo.toLocaleString()}`);
    console.log("===================================");
    console.log("ğŸ’µ Retire su dinero de la bandeja");
    console.log("===================================");
    
    // Mostrar tambiÃ©n en alert
    alert(`âœ… TRANSACCIÃ“N EXITOSA

ğŸ« COMPROBANTE DE RETIRO
================================
ğŸ“… Fecha: ${fechaFormateada}
ğŸ• Hora: ${horaFormateada}
ğŸ’¸ Retirado: $${montoRetirado.toLocaleString()}
ğŸ’° Saldo anterior: $${saldoAnterior.toLocaleString()}
ğŸ’µ Nuevo saldo: $${nuevoSaldo.toLocaleString()}
================================
ğŸ’µ Retire su dinero de la bandeja`);
}

// ===== MÃ“DULO 5: CERRAR SISTEMA =====
function cerrarSistema() {
    sistemaActivo = false;
    
    console.log("ğŸ‘‹ ===== CERRANDO SESIÃ“N =====");
    console.log("âœ… TransacciÃ³n completada");
    console.log("ğŸ’³ Retire su tarjeta");
    console.log("ğŸ™ Gracias por usar nuestro cajero automÃ¡tico");
    console.log("ğŸ˜Š Â¡Que tenga un excelente dÃ­a!");
    console.log("==============================");
    
    alert(`ğŸ‘‹ SESIÃ“N CERRADA

âœ… Operaciones completadas
ğŸ’³ Retire su tarjeta
ğŸ™ Gracias por usar nuestro servicio

ğŸ˜Š Â¡Que tenga un excelente dÃ­a!`);
}

// ===== FUNCIONES DE UTILIDAD =====

// FunciÃ³n para reiniciar el sistema (Ãºtil para pruebas)
function reiniciarCajero() {
    saldoActual = SALDO_INICIAL;
    intentosFallidos = 0;
    sistemaActivo = true;
    
    console.clear();
    console.log("ğŸ”„ Sistema reiniciado");
    iniciarCajero();
}

// FunciÃ³n para mostrar estado del sistema (Ãºtil para debugging)
function mostrarEstadoSistema() {
    console.log("ğŸ“Š ===== ESTADO DEL SISTEMA =====");
    console.log(`ğŸ’° Saldo actual: $${saldoActual.toLocaleString()}`);
    console.log(`ğŸ”‘ PIN correcto: ${PIN_CORRECTO}`);
    console.log(`âŒ Intentos fallidos: ${intentosFallidos}`);
    console.log(`âš¡ Sistema activo: ${sistemaActivo}`);
    console.log("=================================");
}

// ===== INSTRUCCIONES PARA EL USUARIO =====
console.log("ğŸ§ CAJERO AUTOMÃTICO - INSTRUCCIONES");
console.log("====================================");
console.log("ğŸ“ Para comenzar, escriba: iniciarCajero()");
console.log("ğŸ”„ Para reiniciar: reiniciarCajero()");
console.log("ğŸ“Š Para ver estado: mostrarEstadoSistema()");
console.log("====================================");
console.log("â„¹ï¸  PIN de prueba: 1234");
console.log("ğŸ’° Saldo inicial: $100,000");
console.log("====================================");

// ===== INICIO AUTOMÃTICO =====
// Descomenta la siguiente lÃ­nea para inicio automÃ¡tico:
iniciarCajero();